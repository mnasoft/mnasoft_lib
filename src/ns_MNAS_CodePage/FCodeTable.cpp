#include "FCodeTable.h"

CodeTable::CodeTable() : from_to_code( 0 )
{
	set_code_tbl( from_to_code );
}


CodeTable::CodeTable( int From_to_code ) : from_to_code( 0 )
{
	set_code_tbl( From_to_code );
}

char CodeTable::trans_ch( char ch )
{
	unsigned char uch = ch;
	return tbl[ uch ];
}

char * CodeTable::trans_str( char * a, char * rez )
{
	char * tmp = rez;
	while ( *a )
	{
		*tmp = trans_ch( *a );
		tmp++;
		a++;
	}
	*tmp = 0;
	return rez;
}

CodeTable::~CodeTable()
{}

int CodeTable::set_code_tbl( int From_to_code )
{
	if ( From_to_code >= 0 && From_to_code <= 2 )
		from_to_code = From_to_code;

	for ( int i = 0; i < 256; i++ )
		tbl[ i ] = i;
	switch ( from_to_code )
	{
	case 1:      //Win cp=1251->Dos cp=866
		tbl[ 128 ] = 95;
		tbl[ 129 ] = 95;
		tbl[ 130 ] = 39;
		tbl[ 131 ] = 95;
		tbl[ 132 ] = 34;
		tbl[ 133 ] = 58;
		tbl[ 134 ] = 197;
		tbl[ 135 ] = 216;
		tbl[ 136 ] = 95;
		tbl[ 137 ] = 37;
		tbl[ 138 ] = 95;
		tbl[ 139 ] = 60;
		tbl[ 140 ] = 95;
		tbl[ 141 ] = 95;
		tbl[ 142 ] = 95;
		tbl[ 143 ] = 95;
		tbl[ 144 ] = 95;
		tbl[ 145 ] = 39;
		tbl[ 146 ] = 39;
		tbl[ 147 ] = 34;
		tbl[ 148 ] = 34;
		tbl[ 149 ] = 7;
		tbl[ 150 ] = 45;
		tbl[ 151 ] = 45;
		tbl[ 152 ] = 95;
		tbl[ 153 ] = 84;
		tbl[ 154 ] = 95;
		tbl[ 155 ] = 62;
		tbl[ 156 ] = 95;
		tbl[ 157 ] = 95;
		tbl[ 158 ] = 95;
		tbl[ 159 ] = 95;
		tbl[ 160 ] = 255;
		tbl[ 161 ] = 246;
		tbl[ 162 ] = 247;
		tbl[ 163 ] = 95;
		tbl[ 164 ] = 253;
		tbl[ 165 ] = 95;
		tbl[ 166 ] = 179;
		tbl[ 167 ] = 21;
		tbl[ 168 ] = 240;
		tbl[ 169 ] = 99;
		tbl[ 170 ] = 242;
		tbl[ 171 ] = 60;
		tbl[ 172 ] = 191;
		tbl[ 173 ] = 45;
		tbl[ 174 ] = 82;
		tbl[ 175 ] = 244;
		tbl[ 176 ] = 248;
		tbl[ 177 ] = 43;
		tbl[ 178 ] = 95;
		tbl[ 179 ] = 95;
		tbl[ 180 ] = 95;
		tbl[ 181 ] = 231;
		tbl[ 182 ] = 20;
		tbl[ 183 ] = 250;
		tbl[ 184 ] = 241;
		tbl[ 185 ] = 252;
		tbl[ 186 ] = 243;
		tbl[ 187 ] = 62;
		tbl[ 188 ] = 95;
		tbl[ 189 ] = 95;
		tbl[ 190 ] = 95;
		tbl[ 191 ] = 245;
		tbl[ 192 ] = 128;
		tbl[ 193 ] = 129;
		tbl[ 194 ] = 130;
		tbl[ 195 ] = 131;
		tbl[ 196 ] = 132;
		tbl[ 197 ] = 133;
		tbl[ 198 ] = 134;
		tbl[ 199 ] = 135;
		tbl[ 200 ] = 136;
		tbl[ 201 ] = 137;
		tbl[ 202 ] = 138;
		tbl[ 203 ] = 139;
		tbl[ 204 ] = 140;
		tbl[ 205 ] = 141;
		tbl[ 206 ] = 142;
		tbl[ 207 ] = 143;
		tbl[ 208 ] = 144;
		tbl[ 209 ] = 145;
		tbl[ 210 ] = 146;
		tbl[ 211 ] = 147;
		tbl[ 212 ] = 148;
		tbl[ 213 ] = 149;
		tbl[ 214 ] = 150;
		tbl[ 215 ] = 151;
		tbl[ 216 ] = 152;
		tbl[ 217 ] = 153;
		tbl[ 218 ] = 154;
		tbl[ 219 ] = 155;
		tbl[ 220 ] = 156;
		tbl[ 221 ] = 157;
		tbl[ 222 ] = 158;
		tbl[ 223 ] = 159;
		tbl[ 224 ] = 160;
		tbl[ 225 ] = 161;
		tbl[ 226 ] = 162;
		tbl[ 227 ] = 163;
		tbl[ 228 ] = 164;
		tbl[ 229 ] = 165;
		tbl[ 230 ] = 166;
		tbl[ 231 ] = 167;
		tbl[ 232 ] = 168;
		tbl[ 233 ] = 169;
		tbl[ 234 ] = 170;
		tbl[ 235 ] = 171;
		tbl[ 236 ] = 172;
		tbl[ 237 ] = 173;
		tbl[ 238 ] = 174;
		tbl[ 239 ] = 175;
		tbl[ 240 ] = 224;
		tbl[ 241 ] = 225;
		tbl[ 242 ] = 226;
		tbl[ 243 ] = 227;
		tbl[ 244 ] = 228;
		tbl[ 245 ] = 229;
		tbl[ 246 ] = 230;
		tbl[ 247 ] = 231;
		tbl[ 248 ] = 232;
		tbl[ 249 ] = 233;
		tbl[ 250 ] = 234;
		tbl[ 251 ] = 235;
		tbl[ 252 ] = 236;
		tbl[ 253 ] = 237;
		tbl[ 254 ] = 238;
		tbl[ 255 ] = 239;
		break;
	case 2:      //Dos cp=866->Win cp=1251
		tbl[ 15 ] = 164;
		tbl[ 20 ] = 182;
		tbl[ 21 ] = 167;
		tbl[ 128 ] = 192;
		tbl[ 129 ] = 193;
		tbl[ 130 ] = 194;
		tbl[ 131 ] = 195;
		tbl[ 132 ] = 196;
		tbl[ 133 ] = 197;
		tbl[ 134 ] = 198;
		tbl[ 135 ] = 199;
		tbl[ 136 ] = 200;
		tbl[ 137 ] = 201;
		tbl[ 138 ] = 202;
		tbl[ 139 ] = 203;
		tbl[ 140 ] = 204;
		tbl[ 141 ] = 205;
		tbl[ 142 ] = 206;
		tbl[ 143 ] = 207;
		tbl[ 144 ] = 208;
		tbl[ 145 ] = 209;
		tbl[ 146 ] = 210;
		tbl[ 147 ] = 211;
		tbl[ 148 ] = 212;
		tbl[ 149 ] = 213;
		tbl[ 150 ] = 214;
		tbl[ 151 ] = 215;
		tbl[ 152 ] = 216;
		tbl[ 153 ] = 217;
		tbl[ 154 ] = 218;
		tbl[ 155 ] = 219;
		tbl[ 156 ] = 220;
		tbl[ 157 ] = 221;
		tbl[ 158 ] = 222;
		tbl[ 159 ] = 223;
		tbl[ 160 ] = 224;
		tbl[ 161 ] = 225;
		tbl[ 162 ] = 226;
		tbl[ 163 ] = 227;
		tbl[ 164 ] = 228;
		tbl[ 165 ] = 229;
		tbl[ 166 ] = 230;
		tbl[ 167 ] = 231;
		tbl[ 168 ] = 232;
		tbl[ 169 ] = 233;
		tbl[ 170 ] = 234;
		tbl[ 171 ] = 235;
		tbl[ 172 ] = 236;
		tbl[ 173 ] = 237;
		tbl[ 174 ] = 238;
		tbl[ 175 ] = 239;
		tbl[ 176 ] = 45;
		tbl[ 177 ] = 45;
		tbl[ 178 ] = 45;
		tbl[ 179 ] = 166;
		tbl[ 180 ] = 43;
		tbl[ 181 ] = 166;
		tbl[ 182 ] = 166;
		tbl[ 183 ] = 172;
		tbl[ 184 ] = 172;
		tbl[ 185 ] = 166;
		tbl[ 186 ] = 166;
		tbl[ 187 ] = 172;
		tbl[ 188 ] = 45;
		tbl[ 189 ] = 45;
		tbl[ 190 ] = 45;
		tbl[ 191 ] = 172;
		tbl[ 192 ] = 76;
		tbl[ 193 ] = 43;
		tbl[ 194 ] = 84;
		tbl[ 195 ] = 43;
		tbl[ 196 ] = 45;
		tbl[ 197 ] = 43;
		tbl[ 198 ] = 166;
		tbl[ 199 ] = 166;
		tbl[ 200 ] = 76;
		tbl[ 201 ] = 227;
		tbl[ 202 ] = 166;
		tbl[ 203 ] = 84;
		tbl[ 204 ] = 166;
		tbl[ 205 ] = 61;
		tbl[ 206 ] = 43;
		tbl[ 207 ] = 166;
		tbl[ 208 ] = 166;
		tbl[ 209 ] = 84;
		tbl[ 210 ] = 84;
		tbl[ 211 ] = 76;
		tbl[ 212 ] = 76;
		tbl[ 213 ] = 45;
		tbl[ 214 ] = 227;
		tbl[ 215 ] = 43;
		tbl[ 216 ] = 43;
		tbl[ 217 ] = 45;
		tbl[ 218 ] = 45;
		tbl[ 219 ] = 45;
		tbl[ 220 ] = 45;
		tbl[ 221 ] = 166;
		tbl[ 222 ] = 166;
		tbl[ 223 ] = 45;
		tbl[ 224 ] = 240;
		tbl[ 225 ] = 241;
		tbl[ 226 ] = 242;
		tbl[ 227 ] = 243;
		tbl[ 228 ] = 244;
		tbl[ 229 ] = 245;
		tbl[ 230 ] = 246;
		tbl[ 231 ] = 247;
		tbl[ 232 ] = 248;
		tbl[ 233 ] = 249;
		tbl[ 234 ] = 250;
		tbl[ 235 ] = 251;
		tbl[ 236 ] = 252;
		tbl[ 237 ] = 253;
		tbl[ 238 ] = 254;
		tbl[ 239 ] = 255;
		tbl[ 240 ] = 168;
		tbl[ 241 ] = 184;
		tbl[ 242 ] = 170;
		tbl[ 243 ] = 186;
		tbl[ 244 ] = 175;
		tbl[ 245 ] = 191;
		tbl[ 246 ] = 161;
		tbl[ 247 ] = 162;
		tbl[ 248 ] = 176;
		tbl[ 249 ] = 149;
		tbl[ 250 ] = 183;
		tbl[ 251 ] = 118;
		tbl[ 252 ] = 185;
		tbl[ 253 ] = 164;
		tbl[ 254 ] = 166;
		tbl[ 255 ] = 160;
		break;
	case 3:     //Win cp=1251 -> Koi8-r
		tbl[ 192 ] = 225;
		tbl[ 193 ] = 226;
		tbl[ 194 ] = 247;
		tbl[ 195 ] = 231;
		tbl[ 196 ] = 228;
		tbl[ 197 ] = 229;
		tbl[ 168 ] = 179;
		tbl[ 198 ] = 246;
		tbl[ 199 ] = 250;
		tbl[ 200 ] = 233;
		tbl[ 201 ] = 234;
		tbl[ 202 ] = 235;
		tbl[ 203 ] = 236;
		tbl[ 204 ] = 237;
		tbl[ 205 ] = 238;
		tbl[ 206 ] = 239;
		tbl[ 207 ] = 240;
		tbl[ 208 ] = 242;
		tbl[ 209 ] = 243;
		tbl[ 210 ] = 244;
		tbl[ 211 ] = 245;
		tbl[ 212 ] = 230;
		tbl[ 213 ] = 232;
		tbl[ 214 ] = 227;
		tbl[ 215 ] = 254;
		tbl[ 216 ] = 251;
		tbl[ 217 ] = 253;
		tbl[ 218 ] = 255;
		tbl[ 219 ] = 249;
		tbl[ 220 ] = 248;
		tbl[ 221 ] = 252;
		tbl[ 222 ] = 224;
		tbl[ 223 ] = 241;
		tbl[ 224 ] = 193;
		tbl[ 225 ] = 194;
		tbl[ 235 ] = 204;
		tbl[ 227 ] = 199;
		tbl[ 228 ] = 196;
		tbl[ 229 ] = 197;
		tbl[ 184 ] = 163;
		tbl[ 230 ] = 214;
		tbl[ 231 ] = 218;
		tbl[ 232 ] = 201;
		tbl[ 233 ] = 202;
		tbl[ 234 ] = 203;
		tbl[ 235 ] = 204;
		tbl[ 236 ] = 205;
		tbl[ 237 ] = 206;
		tbl[ 238 ] = 207;
		tbl[ 239 ] = 208;
		tbl[ 240 ] = 210;
		tbl[ 241 ] = 211;
		tbl[ 242 ] = 212;
		tbl[ 243 ] = 213;
		tbl[ 244 ] = 198;
		tbl[ 245 ] = 200;
		tbl[ 246 ] = 195;
		tbl[ 247 ] = 222;
		tbl[ 248 ] = 219;
		tbl[ 249 ] = 221;
		tbl[ 250 ] = 223;
		tbl[ 251 ] = 217;
		tbl[ 252 ] = 216;
		tbl[ 253 ] = 220;
		tbl[ 254 ] = 192;
		tbl[ 255 ] = 209;
		tbl[ 255 ] = 255;
		break;
	case 4:
		tbl[ 225 ] = 192;
		tbl[ 226 ] = 193;
		tbl[ 247 ] = 194;
		tbl[ 231 ] = 195;
		tbl[ 228 ] = 196;
		tbl[ 229 ] = 197;
		tbl[ 179 ] = 168;
		tbl[ 246 ] = 198;
		tbl[ 250 ] = 199;
		tbl[ 233 ] = 200;
		tbl[ 234 ] = 201;
		tbl[ 235 ] = 202;
		tbl[ 236 ] = 203;
		tbl[ 237 ] = 204;
		tbl[ 238 ] = 205;
		tbl[ 239 ] = 206;
		tbl[ 240 ] = 207;
		tbl[ 242 ] = 208;
		tbl[ 243 ] = 209;
		tbl[ 244 ] = 210;
		tbl[ 245 ] = 211;
		tbl[ 230 ] = 212;
		tbl[ 232 ] = 213;
		tbl[ 227 ] = 214;
		tbl[ 254 ] = 215;
		tbl[ 251 ] = 216;
		tbl[ 253 ] = 217;
		tbl[ 255 ] = 218;
		tbl[ 249 ] = 219;
		tbl[ 248 ] = 220;
		tbl[ 252 ] = 221;
		tbl[ 224 ] = 222;
		tbl[ 241 ] = 223;
		tbl[ 193 ] = 224;
		tbl[ 194 ] = 225;
		tbl[ 204 ] = 235;
		tbl[ 199 ] = 227;
		tbl[ 196 ] = 228;
		tbl[ 197 ] = 229;
		tbl[ 163 ] = 184;
		tbl[ 214 ] = 230;
		tbl[ 218 ] = 231;
		tbl[ 201 ] = 232;
		tbl[ 202 ] = 233;
		tbl[ 203 ] = 234;
		tbl[ 204 ] = 235;
		tbl[ 205 ] = 236;
		tbl[ 206 ] = 237;
		tbl[ 207 ] = 238;
		tbl[ 208 ] = 239;
		tbl[ 210 ] = 240;
		tbl[ 211 ] = 241;
		tbl[ 212 ] = 242;
		tbl[ 213 ] = 243;
		tbl[ 198 ] = 244;
		tbl[ 200 ] = 245;
		tbl[ 195 ] = 246;
		tbl[ 222 ] = 247;
		tbl[ 219 ] = 248;
		tbl[ 221 ] = 249;
		tbl[ 223 ] = 250;
		tbl[ 217 ] = 251;
		tbl[ 216 ] = 252;
		tbl[ 220 ] = 253;
		tbl[ 192 ] = 254;
		tbl[ 209 ] = 255;
		tbl[ 255 ] = 255;
		break;
	default:
		break;
	}
	return from_to_code;
}

